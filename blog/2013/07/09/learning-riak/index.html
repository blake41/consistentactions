
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>learning riak - Never Graduate</title>
  <meta name="author" content="Blake Johnson">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content="The Flatiron School just started allowing us to order any programming book we want (as long as we explain why it might be useful), so I decided to &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Never Graduate" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="Never Graduate" />
  <meta name="og:title" content="learning riak" />
  <meta name="og:description" content="The Flatiron School just started allowing us to order any programming book we want (as long as we explain why it might be useful), so I decided to &hellip;" />
  <meta name="og:url" content="http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/"/>
  <meta name="url" content="http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/">
  
  <meta name="subject" content=""/>
  <meta name="category" content=""/>
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/">Never Graduate</a>
    <ul class="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/blog/archives">Archives</a></li>
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:blake41.github.com/consistentactions" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
  <div class="wrapper_single">
    <div class="container">
      <article class="span8 offset2" role="article">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title">Learning Riak</h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Blake Johnson</span></span>
  

 - 
        








  


<time datetime="2013-07-09T10:15:00-04:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time> - 
        


        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The Flatiron School just started allowing us to order any programming book we want (as long as we explain why it might be useful), so I decided to take full advantage and explore the world of &#8220;NoSQL&#8221; by reading the Riak handbook over the long weekend.</p>

<p>My general sense of people using &#8220;NoSQL&#8221; data stores was that in 95% of use cases a RDBMS made more sense. But, as long as Mongo stayed hip, people would blindly use it. I wanted to answer this question for myself: If your data is relational, does it make sense to use Mongo?</p>

<p>This whole line of inquiry eventually led me to the CAP theorem and Riak.  Around 2000, Eric Brewer came out with his paper/conjecture called the CAP Theorem <a href="http://www.cs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf">Brewer Paper</a>. The CAP Theorem was eventually proved and started a lot of the discussions around NoSQL. CAP Theroem essentially says that in any distributed system you can&#8217;t have consistency (c), availability (a), and partition tolerance (p) all at the same time: You can only choose two out of the three.</p>

<p>Consistency means that if you have many nodes with the same data, and you read data from more than one at once, you should get the exact same result. Availability means that I should be able to read from all nodes at all times. Partition tolerance means that if nodes are physically separated from each other, usually by network problems, they should still be able to serve both reads and writes.</p>

<p>The theorem states that since we assume that all computers will have network problems and be partitioned from the rest of the nodes at SOME point, you HAVE to pick P as one of the two of three in CAP you are allowed.  So then the question really is, do you compromise your availability or consistency?</p>

<p>A simple example:</p>

<p>Suppose you have three nodes, all with the same data. You try to write data to all three, but one node is unreachable. When you go to read data, you might get stale data from the node that missed the write earlier. If the system allows you to read from the stale node before it&#8217;s been synced up, the system has chosen availability of data as its focus.If it won&#8217;t give you the data until everything has been synced up, it&#8217;s chosen consistency and sacrificed availability.</p>

<p>So, either you can get all data all of the time, and some of it might be wrong, or you get can all of the data most of the time and it&#8217;s always right.  According to the book, many developers claim that their systems are AC systems. This shows a fundamental misunderstanding of CAP. At some point, all systems will face network partitions, or a node will go down; you can&#8217;t choose P. The lack of P chooses you.</p>

<p>So what does Riak choose?  The cool thing about Riak is that it let&#8217;s you decide. Riak was based on a paper that came out of Amazon in 2007 about Dynamo DB, Amazon&#8217;s internal &#8220;eventually consistent&#8221; database. Project Voldemort and CouchDB are also based on this idea of eventual consistency. Riak alows you to tune your needs of consistency and availability. Interally each group within Amazon has different business cases for when they would prefer to have their data be always available and possibly wrong, or always correct and sometimes unavailable.</p>

<p>Let&#8217;s say you have a system with five nodes. You can specify that for any write to be successful it has to be written to W node.  The higher W value you pick the higher your consistency but the higher probability that a write might fail due to an unreachable node. As you lower W your data becomes more likely to successfully write but has a higher probability of being inconsistent - you&#8217;re more likely to read data from a node that hadn&#8217;t been updated. A higher W will also affect speed: The more nodes that must be written to, the higher the network latency.</p>

<p>For reads, the logic is similar. If you need to read consistent data from R nodes for a read to be successful you increase your consistency but also increase the probability that a node is unreachable or has to wait for an update. As you lower your R, the probability a read is successful increases but the read is more likely to have inconsistent data. As you tune both R and W towards N you are lowering your ability to tolerate P (partitions). If R and W are 100%, you can no longer tolerate any partition.</p>

<p>The most common scenario in real world applications is that a write will reach all the relevant nodes eventually, so that all nodes have the same data. Eventually, the data in the whole cluster will be consistent for this particular piece of data, no matter how long it takes, even after network partitions. This is the origin of the term eventual consistency.</p>

<h2>Does Riak replace traditional RDBMS&#8217;s?</h2>

<p>In a word, no.  Riak is really cool, and I&#8217;m excited to play with it, but it solves a very different use case than the traditional SQL databases.</p>

<p>The Riak data model doesn&#8217;t really focus on objects that relate to each other. You can use linking to relate object, but there&#8217;s not really any way to query Riak in the way most web developers are used to. You can use map reduce to replicate that functionality, but you&#8217;d have to write ad hoc map reduce statements every time you needed data which is not really what it&#8217;s for.  Map reduce is really for batch processing of data, not real-time application access to the database. You can also add Lucene to Riak to do full text search of data, but again, this isn&#8217;t really what we want.</p>

<p>The simplest example of why Riak doesn&#8217;t cut it is there&#8217;s really no notion of a collection of Objects. Riak has buckets, but this is really just a string key they add to your actual key. You can&#8217;t ask Riak for all the things in X bucket. It still has to sort through every key in the db to see if it matches the string &#8220;X&#8221;. For this same reason, you can&#8217;t count all the objects in a bucket. Riak does have the notion of relationships through &#8220;linking&#8221; but this really works more like a graph db than traditional relationships as we think of them in the SQL world.</p>

<p>The best way to think of Riak is a key-value store on steroids. It deals really well with distributed storage and replication, fails gracefully, and allows you to tune the AC part of CAP to your heart&#8217;s content.</p>
</div>


  <footer>
    <p class="meta">
      
  


  
    <span class="byline author vcard">by <span class="fn">Blake Johnson</span></span>
  


      








  


<time datetime="2013-07-09T10:15:00-04:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/" data-via="blake41" data-counturl="http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    
      <a class="pull-left" href="/blog/2012/12/05/programming-growth-list-of-achievements/" title="Previous Post: Programming Growth List of Achievements">&laquo; Programming Growth List of Achievements</a>
    
    
  </footer>

</div>

        
          <div class="article-format">
            <h1>Comments</h1>
            <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
          </div>
        
      </article>
    </div>
  </div>
  <div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/blog/2013/07/09/learning-riak/">learning riak</a>
        </li>
      
        <li>
          <a href="/blog/2012/12/05/programming-growth-list-of-achievements/">Programming Growth List of Achievements</a>
        </li>
      
        <li>
          <a href="/blog/2012/12/05/ten-commandments-of-programming/">Ten Commandments of Programming</a>
        </li>
      
        <li>
          <a href="/blog/2012/10/21/becoming-better-means-facing-your-fears/">Becoming Better Means Facing Your Fears</a>
        </li>
      
        <li>
          <a href="/blog/2012/03/01/thing-im-lovin-hat-tip-gvitty-in-the-city/">Things I'm Lovin - Hat tip Gvitty in the city</a>
        </li>
      
    </ul>
    <h2><a href="/blog/archives">archives</a></h2>
  </div>
  <div class="span3">
    
<h2>instagram</h2>
<div class="instagram" data-instagram-user="blake41" data-instagram-client="" data-instagram-access-token=""></div>
<button id="instabutton" class="btn">more</button>


  </div>
  <div class="span4">
    
<h2>twitter</h2>
<a href="https://twitter.com/blake41" class="twitter-follow-button" data-show-count="true" data-lang="en">Follow @blake41</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="tweet" data-twitter-user="blake41">
</div>


  </div>
  <div class="span2">
    <h2>found on</h2>

<a href="https://github.com/blake41/" rel="tooltip" title="Github"><img class="social_icon" title="Github" alt="github icon" src="/images/glyphicons_381_github.png"></a>





<a href="http://www.linkedin.com/in/blake41" rel="tooltip" title="Linkedin"><img class="social_icon" title="Linkedin" alt="Linkedin icon" src="/images/glyphicons_377_linked_in.png"></a>



<a href="http://twitter.com/blake41" rel="tooltip" title="Twitter"><img class="social_icon" title="Twitter" alt="Twitter icon" src="/images/glyphicons_391_twitter_t.png"></a>





<a href="http://www.quora.com/blake41" rel="tooltip" title="Quora"><img class="social_icon" title="Quora" alt="Quora icon" src="/images/glyphicons_385_quora.png"></a>



<h2>contact at</h2>
<a href="mailto:blake41@gmail.com">blake41@gmail.com</a>


  </div>
</div>

  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="/">Never Graduate</a>
  - Copyright &copy; 2013 - Blake Johnson
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/javascripts/custom.js" type="text/javascript"></script>


<script type="text/javascript">
      var disqus_shortname = 'blake41';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/';
        var disqus_url = 'http://blake41.github.com/consistentactions/blog/2013/07/09/learning-riak/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
